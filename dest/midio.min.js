window.Midio=window.Midio||{},window.Midio.BufferReader=function(a){function b(){return o}function c(b){return result=a.slice(o,o+b),o+=b,result}function d(a){for(var b="",c=o;o+a>c;c++)b+=String.fromCharCode(n.getUint8(c));return o+=a,b}function e(){var a=n.getInt8(o);return o+=1,a}function f(){var a=n.getUint8(o);return o+=1,a}function g(a){var b=n.getInt16(o,a||!1);return o+=2,b}function h(a){var b=n.getUint16(o,a||!1);return o+=2,b}function i(a){var b=n.getInt32(o,a||!1);return o+=4,b}function j(a){var b=n.getUint32(o,a|!1);return o+=4,b}function k(a){var b=n.getFloat32(o,a|!1);return o+=4,b}function l(a){var b=n.getFloat64(o,a|!1);return o+=8,b}function m(){for(var a=0;;){var b=e();if(!(128&b))return a+b;a+=127&b,a<<=7}}var n=new DataView(a),o=0;return{buffer:a,dataView:n,getPosition:b,readInt8:e,readUint8:f,readInt16:g,readUint16:h,readInt32:i,readUint32:j,readFloat32:k,readFloat64:l,readBuffer:c,readString:d,readVarInt:m}},window.Midio=window.Midio||{},window.Midio.BufferWriter=function(a){function b(){return o}function c(a){return o=n(o,o.byteLength+1),new DataView(o).setInt8(p,a),p+=1,this}function d(a){return o=n(o,o.byteLength+1),new DataView(o).setUint8(p,a),p+=1,this}function e(a,b){var c=2;return o=n(o,o.byteLength+c),new DataView(o).setInt16(p,a,b||!1),p+=c,this}function f(a,b){var c=2;return o=n(o,o.byteLength+c),new DataView(o).setUint16(p,a,b||!1),p+=c,this}function g(a,b){var c=4;return o=n(o,o.byteLength+c),new DataView(o).setInt32(p,a,b||!1),p+=c,this}function h(a,b){var c=4;return o=n(o,o.byteLength+c),new DataView(o).setUint32(p,a,b),p+=c,this}function i(a,b){var c=4;return o=n(o,o.byteLength+c),new DataView(o).setFloat32(p,a,b),p+=c,this}function j(a,b){var c=8;return o=n(o,o.byteLength+c),new DataView(o).setFloat64(p,a,b),p+=c,this}function k(a){for(var b=127&a,c=[];a>>=7;)b<<=8,b|=127&a|128;for(;;){if(c.push(255&b),!(128&b))break;b>>=8}var d=c.length;o=n(o,o.byteLength+d);for(var e=new DataView(o),f=0;d>f;f++)e.setInt8(p,c[f]),p+=1;return this}function l(a){var b=a.length;o=n(o,o.byteLength+b);for(var c=new DataView(o),d=0;b>d;d++)c.setUint8(p,a.charCodeAt(d)),p+=1;return this}function m(a){var b=a.byteLength,c=new Uint8Array(a);o=n(o,o.byteLength+b);for(var d=new DataView(o),e=0;b>e;e++)d.setUint8(p,c[e]),p+=1;return this}function n(a,b){var c=new ArrayBuffer(b);return new Uint8Array(c).set(new Uint8Array(a)),c}var o=a||new ArrayBuffer,p=0;return{writeInt8:c,writeUint8:d,writeInt16:e,writeUint16:f,writeInt32:g,writeUint32:h,writeFloat32:i,writeFloat64:j,writeVarInt:k,writeString:l,writeBuffer:m,getBuffer:b}},window.Midio=window.Midio||{},window.Midio.Builder=function(){function a(a){var b={},c=a.data?new Midio.BufferReader(a.data):null;switch(a.type){case 0:b.type="sequence-number",b.value=c.readInt16();break;case 1:b.type="text",b.text=c.readString(a.length);break;case 2:b.type="copyright",b.text=c.readString(a.length);break;case 3:b.type="track-name",b.text=c.readString(a.length);break;case 4:b.type="instrument-name",b.text=c.readString(a.length);break;case 5:b.type="lyrics",b.text=c.readString(a.length);break;case 6:b.type="marker",b.text=c.readString(a.length);break;case 7:b.type="cue-point",b.text=c.readString(a.length);break;case 8:b.type="program-name",b.text=c.readString(a.length);break;case 9:b.type="device-name",b.text=c.readString(a.length);break;case 32:b.type="channel-prefix",b.channel=c.readInt8();break;case 33:b.type="midi-port",b.port=c.readInt8();break;case 47:b.type="end-of-track";break;case 81:b.type="set-tempo",b.tempo=(c.readUint8()<<16)+(c.readUint8()<<8)+c.readUint8();break;case 84:b.type="smpte-offset";var d=c.readInt8();b.frameRate={0:24,32:25,64:29,96:30}[96&d],b.hour=31&d,b.min=c.readInt8(),b.sec=c.readInt8(),b.frame=c.readInt8(),b.subframe=c.readInt8();break;case 88:b.type="time-signature",b.numerator=c.readInt8(),b.denominator=Math.pow(2,c.readInt8()),b.metronome=c.readInt8(),b.thirtyseconds=c.readInt8();break;case 89:b.type="key-signature",b.key=c.readInt8(),b.scale=c.readInt8();break;case 127:b.type="sequencer-specific",b.data=c.read(length);break;default:console.log("Unrecognised Message Type: "+a.type)}return b}function b(a){var b={};switch(a.type){case 8:b.type="note-off",b.note=a.param1,b.velocity=a.param2;break;case 9:b.type=0===a.param2?"note-off":"note-on",b.note=a.param1,b.velocity=a.param2;break;case 10:b.type="key-pressure",b.note=a.param1,b.pressure=a.param2;break;case 11:b.type="control-change",b.control=a.param1,b.value=a.param2;break;case 12:b.type="program-change",b.program=a.param1;break;case 13:b.type="channel-pressure",b.pressure=a.param1;break;case 14:b.type="pitch-bend",b.value=a.param1+(a.param2<<7);break;default:console.log("Unrecognised Message Type: "+a.type)}return b.channel=a.channel||0,b.delta=a.delta||0,b}function c(a){var b=new Midio.BufferWriter,c={};switch(a.type){case"sequence-number":c.type=0,c.data=b.writeInt16(a.value).getBuffer(),c.length=c.data.byteLength;break;case"text":c.type=1,c.data=b.writeString(a.text).getBuffer(),c.length=c.data.byteLength;break;case"copyright":c.type=2,c.data=b.writeString(a.text).getBuffer(),c.length=c.data.byteLength;break;case"track-name":c.type=3,c.data=b.writeString(a.text).getBuffer(),c.length=c.data.byteLength;break;case"instrument-name":c.type=4,c.data=b.writeString(a.text).getBuffer(),c.length=c.data.byteLength;break;case"lyrics":c.type=5,c.data=b.writeString(a.text).getBuffer(),c.length=c.data.byteLength;break;case"marker":c.type=6,c.data=b.writeString(a.text).getBuffer(),c.length=c.data.byteLength;break;case"cue-point":c.type=7,c.data=b.writeString(a.text).getBuffer(),c.length=c.data.byteLength;break;case"program-name":c.type=8,c.data=b.writeString(a.text).getBuffer(),c.length=c.data.byteLength;break;case"device-name":c.type=9,c.data=b.writeString(a.text).getBuffer(),c.length=c.data.byteLength;break;case"channel-prefix":c.type=32,c.data=b.writeInt8(a.channel).getBuffer(),c.length=c.data.byteLength;break;case"midi-port":c.type=33,c.data=b.writeInt8(a.port).getBuffer(),c.length=c.data.byteLength;break;case"end-of-track":c.type=47,c.data=null,c.length=0;break;case"set-tempo":c.type=81;var d=a.tempo.toString(16);b.writeUint8(parseInt(d.substring(0,1),16)),b.writeUint8(parseInt(d.substring(1,3),16)),b.writeUint8(parseInt(d.substring(3,5),16)),c.data=b.getBuffer(),c.length=c.data.byteLength;break;case"time-signature":c.type=88,b.writeUint8(a.numerator),b.writeUint8(Math.round(Math.sqrt(a.denominator))),b.writeUint8(a.metronome),b.writeUint8(a.thirtyseconds),c.data=b.getBuffer(),c.length=c.data.byteLength;break;case"key-signature":c.type=89,b.writeInt8(a.key),b.writeInt8(a.scale),c.data=b.getBuffer(),c.length=c.data.byteLength;break;default:c=null}return c}function d(a){var b=(new Midio.BufferWriter,{});switch(a.type){case"note-off":b.type=8,b.param1=a.note,b.param2=a.velocity;break;case"note-on":b.type=9,b.param1=a.note,b.param2=a.velocity;break;case"key-pressure":b.type=10,b.param1=a.note,b.param2=a.pressure;break;case"control-change":b.type=11,b.param1=a.control,b.param2=a.value;break;case"program-change":b.type=12,b.param1=a.program,b.param2=null;break;case"channel-pressure":b.type=13,b.param1=a.pressure,b.param2=null;break;case"pitch-bend":b.type=14,b.param2=Math.floor(a.value/128),b.param1=a.value%128;break;default:b=null}return b&&(b.channel=void 0!==a.channel?a.channel:void 0,b.delta=void 0!==a.delta?a.delta:void 0),b}return{buildMetaMessage:a,buildChannelMessage:b,buildLongMessage:c,buildShortMessage:d}},window.Midio=window.Midio||{},window.Midio.Reader=function(){function a(a){var e={header:null,tracks:[]},f=new Midio.BufferReader(a),g=b(f);if("MThd"!==g.id)throw"Invalid Header";e.header=c(g.buffer);for(var h=0;h<e.header.trackCount;h++){var i=b(f);if("MTrk"!==i.id)throw"Invalid Track";e.tracks.push(d(i.buffer))}return e}function b(a){var b=a.readString(4),c=a.readInt32(),d=a.readBuffer(c);return{id:b,length:c,buffer:d}}function c(a){var b=new Midio.BufferReader(a),c=b.readInt16(),d=b.readInt16(),e=b.readInt16();return{type:c,trackCount:d,division:e}}function d(a){for(var b,c,d,g=[],i=new Midio.BufferReader(a);i.getPosition()<i.buffer.byteLength;)c=i.readVarInt(),d=i.readUint8(),b=240==(240&d)?h.buildMetaMessage(e(i)):h.buildChannelMessage(f(c,d,i)),g.push(b);return g}function e(a){var b=null,c=a.readUint8(),d=a.readVarInt();return d>0&&(b=a.readBuffer(d)),{type:c,length:d,data:b}}function f(a,b,c){var d=null,e=null;0===(128&b)?(d=b,b=i):(d=c.readUint8(),i=b);var f=15&b,h=b>>4;return d||(d=c.readUint8()),g(h)&&(e=c.readUint8()),{delta:a,channel:f,type:h,param1:d,param2:e}}function g(a){return[8,9,10,11,14].includes(a)}var h=new Midio.Builder,i=null;return{read:a,readChunk:b,readHeader:c,readTrack:d}},window.Midio=window.Midio||{},window.Midio.Writer=function(){function a(a){var e=new Midio.BufferWriter,f=b("MThd",c(a.header));return e.writeBuffer(f),a.tracks.forEach(function(a){f=b("MTrk",d(a)),e.writeBuffer(f)}),e.getBuffer()}function b(a,b){var c=new Midio.BufferWriter;return c.writeString(a),c.writeInt32(b.byteLength),c.writeBuffer(b),c.getBuffer()}function c(a){var b=new Midio.BufferWriter;return b.writeInt16(a.type),b.writeInt16(a.trackCount),b.writeInt16(a.division),b.getBuffer()}function d(a){var b=new Midio.BufferWriter;return a.forEach(function(a){e(b,a)}),b.getBuffer()}function e(a,b){var c=h.buildShortMessage(b);if(c)return void g(a,c);var d=h.buildLongMessage(b);if(d)return void f(a,d);throw"Unrecognised Message Type: "+b.type}function f(a,b){a.writeUint8(0),a.writeUint8(255),a.writeUint8(b.type),a.writeVarInt(b.length),b.length>0&&a.writeBuffer(b.data)}function g(a,b){a.writeVarInt(b.delta);var c=parseInt(b.type.toString(16)+b.channel.toString(16),16);a.writeUint8(c),a.writeUint8(b.param1),b.param2&&a.writeUint8(b.param2)}var h=new Midio.Builder;return{write:a,writeChunk:b,writeHeader:c}};